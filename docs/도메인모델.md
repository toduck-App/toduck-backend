## toduck 일정 도메인

- 유저는 일정을 생성할 수 있다
    - 일정에는 단일 일정, 기간 일정이 있다.
    - 종일 여부가 체크 된다면 시간은 선택할 수 없다. 그리고 알람이 1일전이거나 선택하지 말아야한다.
    - 종일 여부를 체크했다면 시간은 필수로 기입해야 한다.
- 유저는 반복되는 일정을 생성할 수 있다
    - 반복 일정에는 단일 반복 일정과 기간 반복 일정이 있다.
- **일정 정보**에는 `제목`, `카테고리`, `카테고리 색`, `일정 시작 날짜`, `일정 마감 날짜`, `종일 여부`, `일정 시간`, `알람 시간`, `반복 요일`, `일정 장소`, `일정 메모`를 입력
  받을 수 있다
- 일정마다 특정 날짜에 수행 완료 여부를 **기록**할 수 있다.
- 일정 수정을 할 수 있다.
    - 단일 무반복 일정은 기존 일정은 수정되고 기존 일정 기록은 삭제 된다.
    - 반복 일정은 단일 수정과 이후 수정을 할 수 있다.
        - 단일 수정 : 반복 일정에서 단일 수정은 기존 일정은 없어지고 수정된 일정만 보여야한다.
        - 이후 수정 : 반복 일정에서 이후 수정은 해당 날짜 이후 모든 반복 일정은 수정 돼야 한다.
- 일정 삭제를 할 수 있다.
    - 단일 무반복 일정은 바로 삭제된다.
    - 반복 일정(단일+기간)은 단일 삭제와 이후 삭제를 할 수 있다.
        - 단일 삭제: 바로 삭제되고 해당 반복에서 없어짐
        - 이후 삭제: 해당 날짜 이후 모든 반복 일정은 삭제됨 단, 일정 기록은 남겨진다.
- 일정 조회를 할 수 있다
    - 해당 기간에 해당하는 일정을 조회한다.
        - 해당 기간에 포함되는 무반복 일정(단일 + 기간)도 같이 조회되어야 한다.
        - 해당 기간 이전에 생성된 반복 일정(단일 + 기간)도 같이 조회되어야 한다

---

## 도메인 모델

### [일정 에거리거트]

## 일정(Schedule)

_Aggregate Root_

### 속성

- `id`: `Long`
- `title`: 일정 제목
- `category`: 일정 카테고리
- `categoryColor`: 일정 카테고리 색
- `startDate`: 일정 시작 날짜
- `endDate`: 일정 마감 날짜
- `dayOfWeekBitmask` : 반복 요일 비트마스크
- `isAllDay`: 종일 여부
- `time`: 일정 시간 (nullable)
- `alarm`: 알람 시간 (nullable)
- `location`: 일정 장소 (nullable)
- `memo`: 일정 메모 (nullable)
- `user` : `User` N:1
- `scheduleRecords`: `ScheduleRecord` 1:N

### 행위

- `static create()`: 일정 생성
- `complete()`: 일정 완료
- `update()` : 일정 수정
- `delete()` : 일정 삭제

### 규칙

- 일정의 종일 여부가 true면
    - 시간이 null이어야 한다.
    - 알람이 1일전이거나 null 이어야 함
- 종일 여부가 false 면
    - 시간은 필수로 기입해야 한다.
- 단일 일정과 기간 일정의 구분
    - 단일 일정 : 시작 날짜와 마감 날짜가 같음
    - 기간 일정 : 마감 날짜가 시작 날짜보다 뒤이어야 함 (커야함)
- 일정은 soft delete로 삭제된다.
- `categoryColor`는 16진수 색상 코드로 표현된다. 예: `#FF5733`
- `일정 완료`는 해당 요청의 날짜에 해당하는 일정 기록 완료 여부를 변경하는 것이다.
    - 일정 기록 데이터가 없을 수도 있을 수도 있으니 있으면 변경 없으면 생성한다.
    - **일정 기록 생성 및 일정 기록 완료 여부 변경은** 해당 기능에만 국한된다.
- `일정 삭제`는 단일 일정 삭제와 이후 삭제가 존재한다.
    - 단일 무반복 일정의 삭제(단일 삭제만 존재)
        - 일정과 일정 해당 기록 삭제
    - 그 외의 일정의 삭제(단일, 이후 삭제)
        - 단일 삭제 : 해당 날짜에 ScheduleRecord 의 deleteAt 를 request 의 Date로 수정 (삭제 마킹 기법 사용)
            - 만약 해당 날짜에 ScheduleRecord 가 없으면 생성하고 삭제 마킹한다.
        - 이후 삭제 : 기존의 Schedule endDate 를 request 의 Date 하루전 (-1)으로 수정한다.
            - 만약 해당 날짜 <= ScheduleRecord recordedDate 와 isComplete 가 true 일정이 있으면 그 일정 기록에 대한 Schedule 을 각각 클론해서 만든다.
                - 단, 완료된 일정들은 하루짜리 반복 x 일정으로 수정
            - Schedule의 endDate 를 request Date의 -1 로 변경했는데 StartDate보다 작을 수는 없다
- `일정 수정`은 단일 수정과 이후 수정이 존재한다.
    - 단일 무반복 일정 수정 (단일 수정만 존재)
        - 기존 일정은 수정된다.
    - 그 외의 일정의 수정(단일, 이후 수정)
        - 단일 수정 : 기존 일정은 삭제되고 수정된 일정만 보여야 한다.
            - 기존 일정은 일정 기록의 deleteAt를 request 의 Date로 수정 (삭제 마킹 기법 사용)
        - 이후 수정 : 해당 날짜 이후 모든 반복 일정은 수정되어야 한다.
            - 만약 해당 날짜 <= ScheduleRecord recordedDate 와 isComplete 가 true 일정이 있으면 그 일정 기록에 대한 Schedule 을 각각 클론해서 만든다.
                - 단, 완료된 일정들은 하루짜리 반복 x 일정으로 수정
            - Schedule의 endDate 를 request Date의 -1 로 변경했는데 StartDate보다 작을 수는 없다

### PlanCategory

_Enum_

- COMPUTER: 컴퓨터
- FOOD: 밥
- PENCIL: 연필
- RED_BOOK: 빨간책
- YELLOW_BOOK: 노란책
- SLEEP: 물
- POWER: 운동
- PEOPLE: 사람
- MEDICINE: 약
- TALK: 채팅
- HEART: 하트
- VEHICLE: 차
- NONE:  None

### PlanCategoryColor

_Value Object_

- `color`: 일정 카테고리 색

### ScheduleDate

_Value Object_

- `startDate`: 일정 시작 날짜
- `endDate`: 일정 마감 날짜

### ScheduleTime

_Value Object_

- `isAllDay`: 종일 여부
- `time`: 일정 시간 (nullable)
- `alarm`: 알람 시간 (nullable)

## 일정 기록 (ScheduleRecord)

_Entity_

### 속성

- `id`: `Long`
- `date`: 일정 수행 날짜
- `isCompleted`: 일정 수행 완료 여부
- `schedule`: `Schedule` N:1
- `deletedAt`: 삭제 일시'

### 행위

- `static create()`: 일정 기록 생성 (일정에 의해 호출)
- `changeComplete()` : 일정 기록 완료 여부 변경 (일정에 의해 호출)

### 규칙

- 일정 기록 생성시 반드시 isCompleted가 false여야 한다.
- 일정 기록은 hard delete로 삭제된다.
